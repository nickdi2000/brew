import{d as I,n as w,j as P,l as k,f as U,G as j,e as D,K as q,c as b,o as m,a as t,g as G,q as N,u,i as Q,b as c,h as i,I as p,t as g,w as H,m as K,F as O,C as J,z as v,x,N as z,v as W,y as _,E as X,Q as Y}from"./index-CILsNvVr.js";const Z={class:"min-h-screen bg-gray-100"},ee={class:"py-6"},te={class:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8"},se={class:"flex items-center mb-6"},ae={class:"bg-white shadow rounded-lg"},re={class:"px-4 py-5 sm:p-6"},oe={class:"text-lg leading-6 font-medium text-gray-900"},le={class:"mt-4 bg-amber-50/50 border border-amber-500/30 rounded-lg p-4"},ne={class:"text-sm text-amber-500"},ie={class:"mt-4 border-b border-gray-200"},de={class:"-mb-px flex space-x-8","aria-label":"Tabs"},me=["onClick"],ue={class:"mt-4"},ce={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},be={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},ve={class:"mt-1 flex rounded-md shadow-sm",role:"group","aria-label":"Member status"},fe={key:0},pe={class:"mt-1 flex items-center"},ge={class:"text-2xl font-semibold text-amber-600"},xe={key:1},ye={key:2,class:"rounded-md bg-red-50 p-4"},he={class:"flex"},we={class:"flex-shrink-0"},ke={class:"ml-3"},Ne={class:"text-sm font-medium text-red-800"},_e={class:"mt-5 flex justify-end space-x-3"},Ce=["disabled"],Me={key:0,class:"flex items-center justify-center"},Te={key:1},Be={class:"space-y-4"},Fe={class:"flex items-center justify-between"},ze={class:"text-3xl font-bold text-amber-600"},Ee={__name:"MemberEdit",setup(Se){const C=Q(),M=P(),l=U(),d=I(),o=w(()=>M.params.id),f=k(!1),n=k(null),y=k("profile"),h=k(!1),S=[{name:"profile",label:"Profile",icon:"mdi:account"},{name:"activity",label:"Activity",icon:"mdi:history"}],$=w(()=>l.getters["transactions/allTransactions"]),A=w(()=>l.getters["transactions/isLoading"]),T=w(()=>l.getters["transactions/currentBalance"]),E=w(()=>l.getters["transactions/error"]),s=k({firstName:"",lastName:"",email:"",phoneNumber:"",membershipLevel:"bronze",status:"active",password:""}),B=async()=>{try{if(n.value=null,o.value){f.value=!0,await l.dispatch("members/fetchMemberDetails",o.value);const a=l.getters["members/currentMember"];if(!a){n.value="Failed to load member details",d("Failed to load member details","error");return}s.value={firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||"",phoneNumber:a.phoneNumber||"",membershipLevel:a.membershipLevel||"bronze",status:a.status||"active"}}else s.value={firstName:"",lastName:"",email:"",phoneNumber:"",membershipLevel:"bronze",status:"active",points:0,password:""}}catch(a){console.error("Error initializing form:",a),n.value="Failed to load member details",d("Failed to load member details","error")}finally{f.value=!1}},V=async()=>{try{f.value=!0,n.value=null,o.value?(await l.dispatch("members/updateMember",{id:o.value,data:s.value}),d("Member updated successfully","success")):(await l.dispatch("members/createMember",s.value),d("Member created successfully","success")),C.push("/admin/members")}catch(a){n.value=a.message||"An error occurred while saving the member.",d(n.value,"error")}finally{f.value=!1}},L=async a=>{try{await l.dispatch("transactions/createTransaction",{memberId:o.value,transactionData:a}),await Promise.all([l.dispatch("transactions/fetchBalance",o.value),l.dispatch("transactions/fetchTransactions",o.value)]),d("Transaction added successfully","success")}catch{d("Failed to add transaction","error")}},F=async()=>{if(o.value){try{l.commit("transactions/SET_ERROR",null),await l.dispatch("transactions/fetchTransactions",o.value)}catch(a){console.error("Failed to load transactions:",a),n.value||d("Failed to load transactions","error");return}try{await l.dispatch("transactions/fetchBalance",o.value)}catch(a){console.error("Failed to load balance:",a)}}};return j(()=>M.params.id,(a,e)=>{a!==e&&(n.value=null,y.value="profile",h.value=!1,B(),F())},{immediate:!1}),D(()=>{B(),F()}),q(()=>{n.value=null,h.value=!1,l.dispatch("transactions/resetState")}),(a,e)=>{const R=K("router-link");return m(),b("div",Z,[t("div",ee,[t("div",te,[t("div",se,[t("button",{type:"button",onClick:e[0]||(e[0]=r=>u(C).back()),class:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500"},[c(u(p),{icon:"mdi:arrow-left",class:"h-5 w-5 mr-2"}),e[11]||(e[11]=i(" Back to Members ",-1))])]),t("div",ae,[t("div",re,[t("h3",oe,g(o.value?"Edit Member":"Add New Member"),1),t("div",le,[t("p",ne,[e[13]||(e[13]=i(" Note: Generally you will not need to add members manually. They will be added automaticallywhen they scan the ",-1)),c(R,{class:"text-amber-500 hover:text-amber-600 underline font-bold",to:"/admin/qr-codes"},{default:H(()=>[...e[12]||(e[12]=[i("QR code",-1)])]),_:1}),e[14]||(e[14]=i(" . ",-1))])]),t("div",ie,[t("nav",de,[(m(),b(O,null,J(S,r=>t("button",{key:r.name,onClick:$e=>y.value=r.name,class:v([y.value===r.name?"border-amber-500 text-amber-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[c(u(p),{icon:r.icon,class:"h-5 w-5 inline-block mr-2"},null,8,["icon"]),i(" "+g(r.label),1)],10,me)),64))])]),t("div",ue,[x(t("div",null,[t("form",{onSubmit:W(V,["prevent"]),class:"space-y-4"},[t("div",ce,[t("div",null,[e[15]||(e[15]=t("label",{for:"firstName",class:"block text-sm font-medium text-gray-700"},"First Name",-1)),x(t("input",{type:"text",id:"firstName","onUpdate:modelValue":e[1]||(e[1]=r=>s.value.firstName=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 sm:text-sm"},null,512),[[_,s.value.firstName]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"lastName",class:"block text-sm font-medium text-gray-700"},"Last Name",-1)),x(t("input",{type:"text",id:"lastName","onUpdate:modelValue":e[2]||(e[2]=r=>s.value.lastName=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 sm:text-sm"},null,512),[[_,s.value.lastName]])])]),t("div",null,[e[17]||(e[17]=t("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Email",-1)),x(t("input",{type:"email",id:"email","onUpdate:modelValue":e[3]||(e[3]=r=>s.value.email=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 sm:text-sm"},null,512),[[_,s.value.email]])]),t("div",be,[t("div",null,[e[21]||(e[21]=t("label",{for:"status",class:"block text-sm font-medium text-gray-700"},"Status",-1)),t("div",ve,[t("button",{type:"button",onClick:e[4]||(e[4]=r=>s.value.status="active"),class:v(["relative inline-flex items-center px-4 py-2 rounded-l-md border text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-amber-500 focus:border-amber-500",s.value.status==="active"?"bg-amber-500 border-amber-500 text-white hover:bg-amber-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"])},[c(u(p),{icon:"mdi:check-circle",class:v(["h-4 w-4 mr-2",s.value.status==="active"?"text-white":"text-gray-400"])},null,8,["class"]),e[18]||(e[18]=i(" Active ",-1))],2),t("button",{type:"button",onClick:e[5]||(e[5]=r=>s.value.status="inactive"),class:v(["relative -ml-px inline-flex items-center px-4 py-2 border text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-amber-500 focus:border-amber-500",s.value.status==="inactive"?"bg-amber-500 border-amber-500 text-white hover:bg-amber-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"])},[c(u(p),{icon:"mdi:pause-circle",class:v(["h-4 w-4 mr-2",s.value.status==="inactive"?"text-white":"text-gray-400"])},null,8,["class"]),e[19]||(e[19]=i(" Inactive ",-1))],2),t("button",{type:"button",onClick:e[6]||(e[6]=r=>s.value.status="suspended"),class:v(["relative -ml-px inline-flex items-center px-4 py-2 rounded-r-md border text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-amber-500 focus:border-amber-500",s.value.status==="suspended"?"bg-amber-500 border-amber-500 text-white hover:bg-amber-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"])},[c(u(p),{icon:"mdi:block-helper",class:v(["h-4 w-4 mr-2",s.value.status==="suspended"?"text-white":"text-gray-400"])},null,8,["class"]),e[20]||(e[20]=i(" Suspended ",-1))],2)])])]),o.value?(m(),b("div",fe,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700"},"Points Balance",-1)),t("div",pe,[t("span",ge,g(T.value),1),e[22]||(e[22]=t("span",{class:"ml-2 text-sm text-gray-500"},"points",-1))])])):N("",!0),o.value?N("",!0):(m(),b("div",xe,[e[24]||(e[24]=t("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"Password",-1)),x(t("input",{type:"password",id:"password","onUpdate:modelValue":e[7]||(e[7]=r=>s.value.password=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 sm:text-sm"},null,512),[[_,s.value.password]])])),n.value?(m(),b("div",ye,[t("div",he,[t("div",we,[c(u(p),{icon:"mdi:close-circle",class:"h-5 w-5 text-red-400","aria-hidden":"true"})]),t("div",ke,[t("h3",Ne,g(n.value),1)])])])):N("",!0),t("div",_e,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[8]||(e[8]=r=>u(C).back())}," Cancel "),t("button",{type:"submit",class:"btn btn-primary",disabled:f.value},[f.value?(m(),b("span",Me,[...e[25]||(e[25]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),i(" Saving... ",-1)])])):(m(),b("span",Te,g(o.value?"Save Changes":"Create Member"),1))],8,Ce)])],32)],512),[[z,y.value==="profile"]]),x(t("div",Be,[t("div",Fe,[t("div",null,[e[26]||(e[26]=t("h4",{class:"text-lg font-medium text-gray-900"},"Points Balance",-1)),t("p",ze,g(T.value)+" points",1)])]),c(X,{transactions:$.value,loading:A.value,error:!!E.value,"show-add-button":!0,onAddTransaction:e[9]||(e[9]=r=>h.value=!0)},null,8,["transactions","loading","error"])],512),[[z,y.value==="activity"]])])])])])]),o.value?(m(),G(Y,{key:0,show:h.value,"member-id":o.value,onClose:e[10]||(e[10]=r=>h.value=!1),onTransactionAdded:L},null,8,["show","member-id"])):N("",!0)])}}};export{Ee as default};
