import{u as I,q as w,x as P,f as k,s as R,B as U,g as j,E as D,c as u,o as d,a as t,N as O,i as N,k as m,l as q,e as c,d as f,I as p,t as g,F as H,y as K,n as b,j as x,K as S,h as G,v as _,A as J,O as Q}from"./index-D2AEptfM.js";const W={class:"min-h-screen bg-gray-100"},X={class:"py-6"},Y={class:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8"},Z={class:"flex items-center mb-6"},ee={class:"bg-white shadow rounded-lg"},te={class:"px-4 py-5 sm:p-6"},se={class:"text-lg leading-6 font-medium text-gray-900"},ae={class:"mt-4 border-b border-gray-200"},re={class:"-mb-px flex space-x-8","aria-label":"Tabs"},oe=["onClick"],le={class:"mt-4"},ne={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},ie={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},de={class:"mt-1 flex rounded-md shadow-sm",role:"group","aria-label":"Member status"},me={key:0},ue={class:"mt-1 flex items-center"},ce={class:"text-2xl font-semibold text-amber-600"},be={key:1},ve={key:2,class:"rounded-md bg-red-50 p-4"},fe={class:"flex"},pe={class:"flex-shrink-0"},ge={class:"ml-3"},xe={class:"text-sm font-medium text-red-800"},ye={class:"mt-5 flex justify-end space-x-3"},he=["disabled"],we={key:0,class:"flex items-center justify-center"},ke={key:1},Ne={class:"space-y-4"},_e={class:"flex items-center justify-between"},Me={class:"text-3xl font-bold text-amber-600"},Fe={__name:"MemberEdit",setup(Ce){const M=q(),C=P(),l=R(),i=I(),o=w(()=>C.params.id),v=k(!1),n=k(null),y=k("profile"),h=k(!1),z=[{name:"profile",label:"Profile",icon:"mdi:account"},{name:"activity",label:"Activity",icon:"mdi:history"}],A=w(()=>l.getters["transactions/allTransactions"]),$=w(()=>l.getters["transactions/isLoading"]),T=w(()=>l.getters["transactions/currentBalance"]),E=w(()=>l.getters["transactions/error"]),s=k({firstName:"",lastName:"",email:"",phoneNumber:"",membershipLevel:"bronze",status:"active",password:""}),B=async()=>{try{if(n.value=null,o.value){v.value=!0,await l.dispatch("members/fetchMemberDetails",o.value);const a=l.getters["members/currentMember"];if(!a){n.value="Failed to load member details",i("Failed to load member details","error");return}s.value={firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||"",phoneNumber:a.phoneNumber||"",membershipLevel:a.membershipLevel||"bronze",status:a.status||"active"}}else s.value={firstName:"",lastName:"",email:"",phoneNumber:"",membershipLevel:"bronze",status:"active",points:0,password:""}}catch(a){console.error("Error initializing form:",a),n.value="Failed to load member details",i("Failed to load member details","error")}finally{v.value=!1}},V=async()=>{try{v.value=!0,n.value=null,o.value?(await l.dispatch("members/updateMember",{id:o.value,data:s.value}),i("Member updated successfully","success")):(await l.dispatch("members/createMember",s.value),i("Member created successfully","success")),M.push("/admin/members")}catch(a){n.value=a.message||"An error occurred while saving the member.",i(n.value,"error")}finally{v.value=!1}},L=async a=>{try{await l.dispatch("transactions/createTransaction",{memberId:o.value,transactionData:a}),await Promise.all([l.dispatch("transactions/fetchBalance",o.value),l.dispatch("transactions/fetchTransactions",o.value)]),i("Transaction added successfully","success")}catch{i("Failed to add transaction","error")}},F=async()=>{if(o.value){try{l.commit("transactions/SET_ERROR",null),await l.dispatch("transactions/fetchTransactions",o.value)}catch(a){console.error("Failed to load transactions:",a),n.value||i("Failed to load transactions","error");return}try{await l.dispatch("transactions/fetchBalance",o.value)}catch(a){console.error("Failed to load balance:",a)}}};return U(()=>C.params.id,(a,e)=>{a!==e&&(n.value=null,y.value="profile",h.value=!1,B(),F())},{immediate:!1}),j(()=>{B(),F()}),D(()=>{n.value=null,h.value=!1,l.dispatch("transactions/resetState")}),(a,e)=>(d(),u("div",W,[t("div",X,[t("div",Y,[t("div",Z,[t("button",{type:"button",onClick:e[0]||(e[0]=r=>m(M).back()),class:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500"},[c(m(p),{icon:"mdi:arrow-left",class:"h-5 w-5 mr-2"}),e[11]||(e[11]=f(" Back to Members ",-1))])]),t("div",ee,[t("div",te,[t("h3",se,g(o.value?"Edit Member":"Add New Member"),1),t("div",ae,[t("nav",re,[(d(),u(H,null,K(z,r=>t("button",{key:r.name,onClick:Te=>y.value=r.name,class:b([y.value===r.name?"border-amber-500 text-amber-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},[c(m(p),{icon:r.icon,class:"h-5 w-5 inline-block mr-2"},null,8,["icon"]),f(" "+g(r.label),1)],10,oe)),64))])]),t("div",le,[x(t("div",null,[t("form",{onSubmit:G(V,["prevent"]),class:"space-y-4"},[t("div",ne,[t("div",null,[e[12]||(e[12]=t("label",{for:"firstName",class:"block text-sm font-medium text-gray-700"},"First Name",-1)),x(t("input",{type:"text",id:"firstName","onUpdate:modelValue":e[1]||(e[1]=r=>s.value.firstName=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 sm:text-sm"},null,512),[[_,s.value.firstName]])]),t("div",null,[e[13]||(e[13]=t("label",{for:"lastName",class:"block text-sm font-medium text-gray-700"},"Last Name",-1)),x(t("input",{type:"text",id:"lastName","onUpdate:modelValue":e[2]||(e[2]=r=>s.value.lastName=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 sm:text-sm"},null,512),[[_,s.value.lastName]])])]),t("div",null,[e[14]||(e[14]=t("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Email",-1)),x(t("input",{type:"email",id:"email","onUpdate:modelValue":e[3]||(e[3]=r=>s.value.email=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 sm:text-sm"},null,512),[[_,s.value.email]])]),t("div",ie,[t("div",null,[e[18]||(e[18]=t("label",{for:"status",class:"block text-sm font-medium text-gray-700"},"Status",-1)),t("div",de,[t("button",{type:"button",onClick:e[4]||(e[4]=r=>s.value.status="active"),class:b(["relative inline-flex items-center px-4 py-2 rounded-l-md border text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-amber-500 focus:border-amber-500",s.value.status==="active"?"bg-amber-500 border-amber-500 text-white hover:bg-amber-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"])},[c(m(p),{icon:"mdi:check-circle",class:b(["h-4 w-4 mr-2",s.value.status==="active"?"text-white":"text-gray-400"])},null,8,["class"]),e[15]||(e[15]=f(" Active ",-1))],2),t("button",{type:"button",onClick:e[5]||(e[5]=r=>s.value.status="inactive"),class:b(["relative -ml-px inline-flex items-center px-4 py-2 border text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-amber-500 focus:border-amber-500",s.value.status==="inactive"?"bg-amber-500 border-amber-500 text-white hover:bg-amber-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"])},[c(m(p),{icon:"mdi:pause-circle",class:b(["h-4 w-4 mr-2",s.value.status==="inactive"?"text-white":"text-gray-400"])},null,8,["class"]),e[16]||(e[16]=f(" Inactive ",-1))],2),t("button",{type:"button",onClick:e[6]||(e[6]=r=>s.value.status="suspended"),class:b(["relative -ml-px inline-flex items-center px-4 py-2 rounded-r-md border text-sm font-medium focus:z-10 focus:outline-none focus:ring-1 focus:ring-amber-500 focus:border-amber-500",s.value.status==="suspended"?"bg-amber-500 border-amber-500 text-white hover:bg-amber-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"])},[c(m(p),{icon:"mdi:block-helper",class:b(["h-4 w-4 mr-2",s.value.status==="suspended"?"text-white":"text-gray-400"])},null,8,["class"]),e[17]||(e[17]=f(" Suspended ",-1))],2)])])]),o.value?(d(),u("div",me,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700"},"Points Balance",-1)),t("div",ue,[t("span",ce,g(T.value),1),e[19]||(e[19]=t("span",{class:"ml-2 text-sm text-gray-500"},"points",-1))])])):N("",!0),o.value?N("",!0):(d(),u("div",be,[e[21]||(e[21]=t("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"Password",-1)),x(t("input",{type:"password",id:"password","onUpdate:modelValue":e[7]||(e[7]=r=>s.value.password=r),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 sm:text-sm"},null,512),[[_,s.value.password]])])),n.value?(d(),u("div",ve,[t("div",fe,[t("div",pe,[c(m(p),{icon:"mdi:close-circle",class:"h-5 w-5 text-red-400","aria-hidden":"true"})]),t("div",ge,[t("h3",xe,g(n.value),1)])])])):N("",!0),t("div",ye,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[8]||(e[8]=r=>m(M).back())}," Cancel "),t("button",{type:"submit",class:"btn btn-primary",disabled:v.value},[v.value?(d(),u("span",we,[...e[22]||(e[22]=[t("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),f(" Saving... ",-1)])])):(d(),u("span",ke,g(o.value?"Save Changes":"Create Member"),1))],8,he)])],32)],512),[[S,y.value==="profile"]]),x(t("div",Ne,[t("div",_e,[t("div",null,[e[23]||(e[23]=t("h4",{class:"text-lg font-medium text-gray-900"},"Points Balance",-1)),t("p",Me,g(T.value)+" points",1)])]),c(J,{transactions:A.value,loading:$.value,error:!!E.value,"show-add-button":!0,onAddTransaction:e[9]||(e[9]=r=>h.value=!0)},null,8,["transactions","loading","error"])],512),[[S,y.value==="activity"]])])])])])]),o.value?(d(),O(Q,{key:0,show:h.value,"member-id":o.value,onClose:e[10]||(e[10]=r=>h.value=!1),onTransactionAdded:L},null,8,["show","member-id"])):N("",!0)]))}};export{Fe as default};
