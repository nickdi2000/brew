import{p as B,u as E,f,q as v,s as S,g as I,c as n,o as i,a as t,e as r,k as a,I as c,x as $,i as R,t as d,l as D,d as x,F,y as V,z as L,n as _}from"./index-D2AEptfM.js";const M={class:"min-h-screen bg-gray-50"},P={key:0,class:"flex items-center justify-center min-h-[50vh]"},z={key:1,class:"flex items-center justify-center min-h-[50vh]"},O={class:"bg-white border-l-4 border-red-500 p-4 rounded-lg max-w-sm shadow-sm"},T={class:"flex items-center"},U={key:2,class:"max-w-7xl mx-auto px-4 py-6"},G={key:0,class:"min-h-xl flex items-center justify-center p-4"},H={class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-8 shadow-xl border border-green-200 max-w-md w-full mx-auto"},J={class:"flex flex-col items-center space-y-4"},K={class:"relative"},Q={class:"flex items-center justify-center h-20 w-20 rounded-full bg-green-100"},W={class:"absolute -right-2 -top-2 animate-bounce"},X={key:0,class:"w-full"},Y={class:"bg-white rounded-xl p-4 shadow border border-green-100"},Z={class:"text-base text-gray-800 font-medium text-center"},ee={key:1},te={key:0,class:"space-y-6"},se={class:"relative h-48 bg-gray-100 overflow-hidden"},oe=["src","alt"],ne={key:1,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-r from-amber-500 to-amber-600"},ie={class:"absolute bottom-0 left-0 right-0 flex items-end justify-between p-6"},ae={class:"text-2xl font-bold text-white drop-shadow-lg"},le={class:"bg-white/90 backdrop-blur-sm rounded-full px-4 py-2"},re={class:"text-lg font-bold text-amber-600"},ce={class:"p-6"},de={class:"mb-4"},me={class:"mb-4"},ue={key:0,class:"text-sm text-gray-500"},pe={key:1},xe=["onClick"],ge={key:1,class:"text-sm text-gray-500"},he=["onClick"],ye={class:"w-full"},be=["onClick","disabled"],fe={key:0},ve={key:1},_e={key:2},ke={key:3},we={key:4},Ce={key:1,class:"text-center py-12 bg-white shadow rounded-xl"},Ne=B({__name:"PortalRewards",setup(Re){const k=S(),g=D(),u=$(),w=E(),p=f(!0),h=f(!1),y=f([]),b=v(()=>k.getters["auth/currentMembership"]);v(()=>k.getters.organization);const j=v(()=>[...y.value].sort((o,s)=>{const e=l(o),m=l(s);return e&&!m?-1:!e&&m?1:0})),N=async()=>{try{p.value=!0,h.value=!1;const o=await L.getRewards();y.value=o.rewards.map(s=>({...s,expanded:!1}))}catch{h.value=!0,w("Failed to load rewards","error")}finally{p.value=!1}},q=o=>{const s={"Birthday Reward":"mdi:cake","VIP Experience":"mdi:star","Mystery Brew":"mdi:flask","Loyalty Bonus":"mdi:heart",Achievement:"mdi:trophy"};if(s[o.name])return s[o.name];switch(o.type){case"product":return"mdi:gift";case"service":return"mdi:sparkles";case"discount":return"mdi:ticket";case"experience":return"mdi:star";default:return"mdi:gift"}},l=o=>{const s=b.value?.points??0,e=o.quantity===null||o.quantity>0,m=!o.expiresAt||new Date(o.expiresAt)>new Date;return o.isActive&&e&&m&&s>=o.pointsCost},C=o=>{o.expanded=!o.expanded},A=o=>{if(!l(o))return;const s=u.params.code;g.push({name:"member-redeem",params:{code:s,id:o._id}})};return I(async()=>{try{await N()}catch(o){console.error("❌ Failed to load rewards:",o),w("Failed to load rewards","error")}}),(o,s)=>(i(),n("div",M,[p.value?(i(),n("div",P,[...s[2]||(s[2]=[t("div",{class:"text-center"},[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600 mx-auto"}),t("p",{class:"mt-4 text-gray-500 animate-pulse"},"Loading rewards...")],-1)])])):h.value?(i(),n("div",z,[t("div",O,[t("div",T,[r(a(c),{icon:"mdi:alert",class:"h-5 w-5 text-red-500 flex-shrink-0"}),s[3]||(s[3]=t("p",{class:"ml-3 text-sm text-gray-700"},"Unable to load rewards.",-1))])])])):(i(),n("div",U,[a(u).query.redeemed==="1"?(i(),n("div",G,[t("div",H,[t("div",J,[t("div",K,[t("div",Q,[r(a(c),{icon:"mdi:check-circle",class:"h-12 w-12 text-green-600"})]),t("div",W,[r(a(c),{icon:"mdi:party-popper",class:"h-8 w-8 text-green-500"})])]),s[5]||(s[5]=t("div",{class:"text-center"},[t("h1",{class:"text-3xl font-bold text-green-800"},"Success!"),t("p",{class:"text-lg text-green-700 font-medium mt-1"},"Reward redeemed successfully")],-1)),a(u).query.rewardName?(i(),n("div",X,[t("div",Y,[t("p",Z,d(String(a(u).query.rewardName)),1)])])):R("",!0),t("button",{onClick:s[0]||(s[0]=e=>a(g).push(`/members/${a(u).params.code}`)),class:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-xl transition-colors shadow-md flex items-center justify-center gap-2"},[r(a(c),{icon:"mdi:arrow-left",class:"h-5 w-5"}),s[4]||(s[4]=x(" Back to Portal ",-1))])])])])):(i(),n("div",ee,[t("button",{onClick:s[1]||(s[1]=e=>a(g).push(`/members/${a(u).params.code}`)),class:"mb-6 inline-flex items-center text-gray-600 hover:text-gray-900"},[r(a(c),{icon:"mdi:arrow-left",class:"h-5 w-5 mr-1"}),s[6]||(s[6]=t("span",null,"Back",-1))]),y.value.length>0?(i(),n("div",te,[(i(!0),n(F,null,V(j.value,e=>(i(),n("div",{key:e._id,class:_(["group overflow-hidden rounded-xl shadow-lg hover:shadow-xl transition-all duration-200",l(e)?"bg-white ring-2 ring-green-400 ring-opacity-50":"bg-gray-50 opacity-75"])},[t("div",se,[e.base64Image?(i(),n("img",{key:0,src:e.base64Image,alt:e.name,class:"absolute inset-0 w-full h-full object-cover object-center"},null,8,oe)):(i(),n("div",ne,[r(a(c),{icon:q(e),class:"h-16 w-16 text-white"},null,8,["icon"])])),s[7]||(s[7]=t("div",{class:"absolute inset-0 bg-gradient-to-r from-black/50 via-transparent to-black/50"},null,-1)),t("div",ie,[t("h3",ae,d(e.name),1),t("div",le,[t("span",re,d(e.pointsCost.toLocaleString())+" pts",1)])])]),t("div",ce,[t("div",de,[t("span",{class:_(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",l(e)?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"])},[r(a(c),{icon:l(e)?"mdi:check-circle":"mdi:lock",class:"mr-1.5 h-4 w-4"},null,8,["icon"]),x(" "+d(l(e)?"Eligible":"Not enough points"),1)],2)]),t("div",me,[e.description.length<=70?(i(),n("p",ue,d(e.description),1)):(i(),n("div",pe,[e.expanded?(i(),n("p",ge,[x(d(e.description)+" ",1),t("span",{class:"text-amber-600 font-medium ml-1 cursor-pointer hover:text-amber-700 transition-colors",onClick:m=>C(e)}," Show less ",8,he)])):(i(),n("p",{key:0,class:"text-sm text-gray-500 cursor-pointer hover:text-gray-700 transition-colors",onClick:m=>C(e)},[x(d(e.description.substring(0,70))+"... ",1),s[8]||(s[8]=t("span",{class:"text-amber-600 font-medium ml-1"},"Read more",-1))],8,xe))]))]),t("div",ye,[t("button",{onClick:m=>A(e),class:_(["w-full px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2",{"bg-black text-white hover:bg-gray-800 hover:scale-[1.02]":l(e),"bg-gray-100 text-gray-400 cursor-not-allowed":!l(e)}]),disabled:!l(e)},[r(a(c),{icon:l(e)?"mdi:gift":"mdi:lock",class:"h-5 w-5"},null,8,["icon"]),e.isActive?e.isExpired||e.expiresAt&&new Date(e.expiresAt)<=new Date?(i(),n("span",ve,"Expired")):e.isOutOfStock||typeof e.quantity=="number"&&e.quantity<=0?(i(),n("span",_e,"Out of Stock")):(b.value?.points??0)<e.pointsCost?(i(),n("span",ke," Need "+d(e.pointsCost-(b.value?.points??0))+" More Points ",1)):(i(),n("span",we,"Redeem Now")):(i(),n("span",fe,"Currently Unavailable"))],10,be)])])],2))),128))])):p.value?R("",!0):(i(),n("div",Ce,[r(a(c),{icon:"mdi:ticket",class:"mx-auto h-12 w-12 text-gray-400"}),s[9]||(s[9]=t("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No rewards available",-1)),s[10]||(s[10]=t("p",{class:"mt-1 text-sm text-gray-500"},"Check back later for new rewards.",-1))]))]))]))]))}});export{Ne as default};
