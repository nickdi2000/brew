import{c as d,o as n,a as e,b as o,u as l,I as c,d as k,r as v,e as _,f as M,g as L,h as f,t as j,i as T,j as B,k as R}from"./index-CILsNvVr.js";const $={class:"min-h-screen flex items-center justify-center bg-amber-50 px-4"},q={class:"w-full max-w-sm"},F={class:"bg-white shadow-xl rounded-2xl p-8 space-y-6 text-center"},C={class:"relative h-24 flex items-center justify-center"},N={class:"relative z-10 flex flex-col items-center gap-1"},V={__name:"MagicLoginTransition",setup(x){return(u,i)=>(n(),d("div",$,[e("div",q,[e("div",F,[o(l(c),{icon:"mdi:beer",class:"mx-auto h-12 w-12 text-amber-500"}),i[3]||(i[3]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Logging you inâ€¦",-1)),i[4]||(i[4]=e("p",{class:"text-sm text-gray-600"},"Hold tight while we get your admin portal ready.",-1)),e("div",C,[i[1]||(i[1]=e("div",{class:"absolute inset-0 flex items-center justify-center"},[e("div",{class:"h-20 w-20 rounded-full border-4 border-amber-200"})],-1)),i[2]||(i[2]=e("div",{class:"absolute inset-0 flex items-center justify-center animate-spin"},[e("div",{class:"h-20 w-20 rounded-full border-4 border-amber-500 border-t-transparent"})],-1)),e("div",N,[o(l(c),{icon:"mdi:coffee",class:"h-8 w-8 text-amber-600 animate-bounce"}),i[0]||(i[0]=e("span",{class:"text-xs font-medium text-gray-500 tracking-wide"},"Brewing session",-1))])])])])]))}},E={key:1,class:"min-h-screen flex items-center justify-center bg-gray-50 px-4"},D={class:"w-full max-w-md"},H={class:"bg-white shadow-lg rounded-2xl p-8 space-y-6"},I={class:"text-center space-y-3"},S={key:0,class:"space-y-4"},U={class:"flex items-center justify-center text-gray-500 text-sm"},W={key:1,class:"space-y-4"},z={class:"flex items-center justify-center text-red-600"},P={__name:"MagicLogin",setup(x){const u=T(),i=B(),r=k(),m=M(),a=v({status:"loading",errorMessage:"",email:""}),g=async()=>{try{await u.replace({name:"dashboard"})}catch(t){console.error("Failed to redirect after magic login:",t)}},y=t=>{a.status="error",a.errorMessage=t,r(t,"error")},p=async()=>{const t=i.params.token;if(!t){y("Magic login token is missing from the URL.");return}try{const s=await m.dispatch("magicLogin",{token:t,redirect:i.query.redirect||"/admin",skipRedirect:!0});if(!s?.success)throw new Error(s?.message||"Magic login link is invalid.");const w=s?.data||{};a.email=w?.user?.email||"",a.status="transition",setTimeout(()=>{a.status="success",setTimeout(()=>{g()},1200)},3e3)}catch(s){console.error("Magic login validation failed:",s),y(s?.response?.data?.message||s?.message||"Magic login validation failed.")}},b=()=>{u.push({name:"admin-login",query:{email:a.email}})},h=async()=>{if(!a.email){r("We could not determine your email. Please request a new link from the login page.","error");return}try{const t=await R(a.email);if(!t?.success)throw new Error(t?.message||"Failed to send magic login link.");r("Magic login link sent! Check your inbox.","success")}catch(t){console.error("Failed to issue new magic link:",t),r(t?.response?.data?.message||t?.message||"Failed to send magic login link.","error")}};return _(()=>{if(m.getters.isAuthenticated&&m.getters.currentUser){r("You are already signed in. Redirecting you now.","success"),g();return}p()}),(t,s)=>a.status==="transition"?(n(),L(V,{key:0})):(n(),d("div",E,[e("div",D,[e("div",H,[e("div",I,[o(l(c),{icon:"mdi:beer",class:"mx-auto h-12 w-12 text-amber-500"}),s[0]||(s[0]=e("h1",{class:"text-2xl font-semibold text-gray-900"},"Magic Login",-1)),s[1]||(s[1]=e("p",{class:"text-sm text-gray-600"}," We are verifying your magic login link. Hang tight! ",-1))]),a.status==="loading"?(n(),d("div",S,[s[3]||(s[3]=e("div",{class:"animate-pulse bg-amber-100 h-2 rounded-full"},null,-1)),e("div",U,[o(l(c),{icon:"mdi:clock-outline",class:"w-5 h-5 mr-2"}),s[2]||(s[2]=f(" Checking your token... ",-1))])])):(n(),d("div",W,[e("div",z,[o(l(c),{icon:"mdi:alert",class:"w-6 h-6 mr-2"}),f(" "+j(a.errorMessage||"Magic link validation failed."),1)]),e("div",{class:"space-y-2"},[e("button",{type:"button",class:"btn btn-primary w-full",onClick:b}," Back to Login "),e("button",{type:"button",class:"btn btn-secondary w-full",onClick:h}," Request new magic link ")])]))])])]))}};export{P as default};
