import{m as I,u as S,f as v,p as y,q as $,g as q,c as n,o as i,a as e,e as l,k as a,I as d,s as E,i as R,t as c,l as F,d as u,F as L,x as V,y as D,n as _}from"./index-DW8W1nU3.js";const M={class:"min-h-screen bg-gray-50"},P={key:0,class:"flex items-center justify-center min-h-[50vh]"},T={key:1,class:"flex items-center justify-center min-h-[50vh]"},z={class:"bg-white border-l-4 border-red-500 p-4 rounded-lg max-w-sm shadow-sm"},U={class:"flex items-center"},Y={key:2,class:"max-w-7xl mx-auto px-4 py-6"},G={key:0,class:"min-h-screen flex items-center justify-center p-4"},H={class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-8 shadow-xl border border-green-200 max-w-md w-full mx-auto"},J={class:"flex flex-col items-center space-y-4"},K={class:"relative"},O={class:"flex items-center justify-center h-20 w-20 rounded-full bg-green-100"},Q={class:"absolute -right-2 -top-2 animate-bounce"},W={key:0,class:"w-full"},X={class:"bg-white rounded-xl p-4 shadow border border-green-100"},Z={class:"text-base text-gray-800 font-medium text-center"},ee={key:1},te={class:"mb-8 bg-gradient-to-r from-amber-50 via-amber-100 to-amber-50 rounded-2xl p-8 shadow-sm border border-amber-100"},se={class:"flex items-center gap-3 mb-2"},oe={class:"mt-3 text-gray-600 text-lg flex items-center gap-2"},ne={class:"font-semibold text-2xl bg-gradient-to-r from-amber-600 to-amber-500 bg-clip-text text-transparent"},ie={key:0,class:"space-y-6"},ae={class:"relative h-48 bg-gray-100 overflow-hidden"},re=["src","alt"],le={key:1,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-r from-amber-500 to-amber-600"},de={class:"absolute bottom-0 left-0 right-0 flex items-end justify-between p-6"},ce={class:"text-2xl font-bold text-white drop-shadow-lg"},me={class:"bg-white/90 backdrop-blur-sm rounded-full px-4 py-2"},ue={class:"text-lg font-bold text-amber-600"},pe={class:"p-6"},ge={class:"mb-4"},xe={class:"mb-4"},be={key:0,class:"text-sm text-gray-500"},he={key:1},fe=["onClick"],ve={key:1,class:"text-sm text-gray-500"},ye=["onClick"],_e={class:"w-full"},ke=["onClick","disabled"],we={key:0},Ce={key:1},Re={key:2},je={key:1,class:"text-center py-12 bg-white shadow rounded-xl"},Ae=I({__name:"PortalRewards",setup(Ne){const k=$(),b=F(),m=E(),w=S(),g=v(!0),h=v(!1),f=v([]),x=y(()=>k.getters["auth/currentMembership"]);y(()=>k.getters.organization);const j=y(()=>[...f.value].sort((o,t)=>{const s=r(o),p=r(t);return s&&!p?-1:!s&&p?1:0})),N=async()=>{try{g.value=!0,h.value=!1;const o=await D.getRewards();f.value=o.rewards.map(t=>({...t,expanded:!1}))}catch{h.value=!0,w("Failed to load rewards","error")}finally{g.value=!1}},B=o=>{const t={"Birthday Reward":"mdi:cake","VIP Experience":"mdi:star","Mystery Brew":"mdi:flask","Loyalty Bonus":"mdi:heart",Achievement:"mdi:trophy"};if(t[o.name])return t[o.name];switch(o.type){case"product":return"mdi:gift";case"service":return"mdi:sparkles";case"discount":return"mdi:ticket";case"experience":return"mdi:star";default:return"mdi:gift"}},r=o=>{const t=x.value?.points??0;return o.isAvailable&&t>=o.pointsCost&&(!o.quantity||o.quantity>0)&&(!o.expiresAt||new Date(o.expiresAt)>new Date)},C=o=>{o.expanded=!o.expanded},A=o=>{if(!r(o))return;const t=m.params.code;b.push({name:"member-redeem",params:{code:t,id:o._id}})};return q(async()=>{try{await N()}catch(o){console.error("❌ Failed to load rewards:",o),w("Failed to load rewards","error")}}),(o,t)=>(i(),n("div",M,[g.value?(i(),n("div",P,[...t[2]||(t[2]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600 mx-auto"}),e("p",{class:"mt-4 text-gray-500 animate-pulse"},"Loading rewards...")],-1)])])):h.value?(i(),n("div",T,[e("div",z,[e("div",U,[l(a(d),{icon:"mdi:alert",class:"h-5 w-5 text-red-500 flex-shrink-0"}),t[3]||(t[3]=e("p",{class:"ml-3 text-sm text-gray-700"},"Unable to load rewards.",-1))])])])):(i(),n("div",Y,[a(m).query.redeemed==="1"?(i(),n("div",G,[e("div",H,[e("div",J,[e("div",K,[e("div",O,[l(a(d),{icon:"mdi:check-circle",class:"h-12 w-12 text-green-600"})]),e("div",Q,[l(a(d),{icon:"mdi:party-popper",class:"h-8 w-8 text-green-500"})])]),t[5]||(t[5]=e("div",{class:"text-center"},[e("h1",{class:"text-3xl font-bold text-green-800"},"Success!"),e("p",{class:"text-lg text-green-700 font-medium mt-1"},"Reward redeemed successfully")],-1)),a(m).query.rewardName?(i(),n("div",W,[e("div",X,[e("p",Z,c(String(a(m).query.rewardName)),1)])])):R("",!0),e("button",{onClick:t[0]||(t[0]=s=>a(b).push(`/members/${a(m).params.code}`)),class:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-xl transition-colors shadow-md flex items-center justify-center gap-2"},[l(a(d),{icon:"mdi:arrow-left",class:"h-5 w-5"}),t[4]||(t[4]=u(" Back to Portal ",-1))])])])])):(i(),n("div",ee,[e("button",{onClick:t[1]||(t[1]=s=>a(b).push(`/members/${a(m).params.code}`)),class:"mb-6 inline-flex items-center text-gray-600 hover:text-gray-900"},[l(a(d),{icon:"mdi:arrow-left",class:"h-5 w-5 mr-1"}),t[6]||(t[6]=e("span",null,"Back",-1))]),e("div",te,[e("div",se,[l(a(d),{icon:"mdi:star",class:"h-8 w-8 text-amber-500"}),t[7]||(t[7]=e("h1",{class:"text-3xl font-bold bg-gradient-to-r from-amber-700 to-amber-500 bg-clip-text text-transparent"}," Available Rewards ",-1))]),e("p",oe,[t[8]||(t[8]=u(" You have ",-1)),e("span",ne,c((x.value?.points??0).toLocaleString()),1),t[9]||(t[9]=u(" points available ",-1))])]),f.value.length>0?(i(),n("div",ie,[(i(!0),n(L,null,V(j.value,s=>(i(),n("div",{key:s._id,class:_(["group overflow-hidden rounded-xl shadow-lg hover:shadow-xl transition-all duration-200",r(s)?"bg-white ring-2 ring-green-400 ring-opacity-50":"bg-gray-50 opacity-75"])},[e("div",ae,[s.base64Image?(i(),n("img",{key:0,src:s.base64Image,alt:s.name,class:"absolute inset-0 w-full h-full object-cover object-center"},null,8,re)):(i(),n("div",le,[l(a(d),{icon:B(s),class:"h-16 w-16 text-white"},null,8,["icon"])])),t[10]||(t[10]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-black/50 via-transparent to-black/50"},null,-1)),e("div",de,[e("h3",ce,c(s.name),1),e("div",me,[e("span",ue,c(s.pointsCost.toLocaleString())+" pts",1)])])]),e("div",pe,[e("div",ge,[e("span",{class:_(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",r(s)?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"])},[l(a(d),{icon:r(s)?"mdi:check-circle":"mdi:lock",class:"mr-1.5 h-4 w-4"},null,8,["icon"]),u(" "+c(r(s)?"Eligible":"Not enough points"),1)],2)]),e("div",xe,[s.description.length<=70?(i(),n("p",be,c(s.description),1)):(i(),n("div",he,[s.expanded?(i(),n("p",ve,[u(c(s.description)+" ",1),e("span",{class:"text-amber-600 font-medium ml-1 cursor-pointer hover:text-amber-700 transition-colors",onClick:p=>C(s)}," Show less ",8,ye)])):(i(),n("p",{key:0,class:"text-sm text-gray-500 cursor-pointer hover:text-gray-700 transition-colors",onClick:p=>C(s)},[u(c(s.description.substring(0,70))+"... ",1),t[11]||(t[11]=e("span",{class:"text-amber-600 font-medium ml-1"},"Read more",-1))],8,fe))]))]),e("div",_e,[e("button",{onClick:p=>A(s),class:_(["w-full px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2",{"bg-black text-white hover:bg-gray-800 hover:scale-[1.02]":r(s),"bg-gray-100 text-gray-400 cursor-not-allowed":!r(s)}]),disabled:!r(s)},[l(a(d),{icon:r(s)?"mdi:gift":"mdi:lock",class:"h-5 w-5"},null,8,["icon"]),s.isAvailable?(x.value?.points??0)<s.pointsCost?(i(),n("span",Ce," Need "+c(s.pointsCost-(x.value?.points??0))+" More Points ",1)):(i(),n("span",Re,"Redeem Now")):(i(),n("span",we,"Currently Unavailable"))],10,ke)])])],2))),128))])):g.value?R("",!0):(i(),n("div",je,[l(a(d),{icon:"mdi:ticket",class:"mx-auto h-12 w-12 text-gray-400"}),t[12]||(t[12]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No rewards available",-1)),t[13]||(t[13]=e("p",{class:"mt-1 text-sm text-gray-500"},"Check back later for new rewards.",-1))]))]))]))]))}});export{Ae as default};
