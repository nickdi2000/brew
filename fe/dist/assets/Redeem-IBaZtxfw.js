import{m as V,f as r,p as k,A as H,g as W,B as Q,c as d,o as u,a as e,e as g,i as B,t as c,C as N,n as L,k as f,I as h,T as Y,w as J,_ as Z,u as ee,q as te,d as I,l as se,s as ae,y as O}from"./index-BuODUq5K.js";const ne={class:"w-full space-y-3"},ie={class:"text-center"},oe={key:0,class:"text-base font-semibold text-gray-900"},le={key:1,class:"mt-1 text-sm text-gray-500"},re=["aria-label","aria-disabled"],de={class:"relative flex-1 flex items-center justify-center pointer-events-none"},ue={key:"helper",class:"text-center text-xs text-gray-500"},T=.85,z=8,ce=V({__name:"SlideToConfirm",props:{label:{type:String,default:"Slide to confirm"},confirmLabel:{type:String,default:"Keep sliding to confirm"},successLabel:{type:String,default:"Confirmed"},subtitle:{type:String,default:""},title:{type:String,default:""},icon:{type:String,default:"mdi:arrow-right"},successIcon:{type:String,default:"mdi:check"},loadingIcon:{type:String,default:"mdi:loading"},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},helperText:{type:String,default:""},autoReset:{type:Boolean,default:!0},trackHeight:{type:Number,default:60}},emits:["confirm"],setup(a,{expose:S,emit:E}){const i=a,$=E,m=r(0),v=r(!1),x=r(null),s=r(!1),b=r(0),p=r(0),o=r(null),_=r(null),y=r(null),R=k(()=>Math.max(b.value-p.value-z*2,0)),M=k(()=>v.value&&(i.loading||m.value===1)?R.value:Math.min(R.value,Math.max(0,m.value*R.value))),D=k(()=>{const n=z+p.value/2+M.value;return n<=0?0:Math.min(b.value,n)}),l=k(()=>v.value&&!i.loading||m.value>=T&&!i.loading?i.successIcon:i.icon),t=k(()=>i.loading?"Processing...":v.value?i.successLabel:m.value>=T?i.confirmLabel:i.label),w=()=>{!o.value||!_.value||(b.value=o.value.offsetWidth,p.value=_.value.offsetWidth)},F=n=>Math.min(1,Math.max(0,n)),q=n=>{if(!o.value)return;const C=o.value.getBoundingClientRect(),G=n-C.left-z-p.value/2,K=F(G/Math.max(R.value,1));m.value=K},U=()=>{if(s.value){if(s.value=!1,x.value=null,window.removeEventListener("pointermove",j),window.removeEventListener("pointerup",A),i.disabled||i.loading){P();return}m.value>=T?(v.value=!0,m.value=1,$("confirm")):P()}},P=()=>{m.value=0,v.value=!1},j=n=>{!s.value||x.value!==n.pointerId||(n.preventDefault(),q(n.clientX))},A=n=>{x.value===n.pointerId&&(n.preventDefault(),U())},X=n=>{if(!(i.disabled||i.loading)){if(o.value)try{o.value.setPointerCapture(n.pointerId)}catch(C){console.debug("Unable to set pointer capture",C)}w(),s.value=!0,x.value=n.pointerId,q(n.clientX),window.addEventListener("pointermove",j,{passive:!1}),window.addEventListener("pointerup",A,{passive:!1})}};return H(()=>i.loading,(n,C)=>{!n&&C&&i.autoReset&&P()}),H(()=>i.disabled,n=>{n&&P()}),W(()=>{w(),y.value=new ResizeObserver(()=>{w()}),o.value&&y.value.observe(o.value),window.addEventListener("resize",w)}),Q(()=>{window.removeEventListener("pointermove",j),window.removeEventListener("pointerup",A),window.removeEventListener("resize",w),y.value&&o.value&&y.value.unobserve(o.value),y.value=null}),S({resetSlider:P}),(n,C)=>(u(),d("div",ne,[e("div",ie,[a.title?(u(),d("h3",oe,c(a.title),1)):B("",!0),a.subtitle?(u(),d("p",le,c(a.subtitle),1)):B("",!0)]),e("div",{ref_key:"trackRef",ref:o,class:L(["relative flex items-center rounded-full bg-gray-100 shadow-inner overflow-hidden touch-pan-y",[a.disabled||a.loading?"opacity-60 cursor-not-allowed":"cursor-pointer",v.value&&!a.loading?"bg-amber-100":"bg-gray-100"]]),style:N({height:`${a.trackHeight}px`}),role:"button","aria-label":a.title||a.label,"aria-disabled":a.disabled||a.loading,onPointerdown:X},[e("div",{class:"absolute inset-y-0 left-0 bg-amber-500 transition-colors",style:N({width:`${D.value}px`})},null,4),e("div",de,[e("span",{class:L(["text-sm font-medium transition-colors",[v.value&&!a.loading||m.value>=T?"text-amber-700":"text-gray-600",a.loading?"opacity-70":"opacity-100"]])},c(t.value),3)]),e("div",{ref_key:"handleRef",ref:_,class:L(["absolute top-1 bottom-1 left-1 w-14 rounded-full bg-white shadow-lg flex items-center justify-center transition-transform duration-150 ease-out",[v.value&&!a.loading?"ring-2 ring-amber-400":"ring-0",a.disabled||a.loading?"pointer-events-none":"pointer-events-auto"]]),style:N({transform:`translateX(${M.value}px)`})},[g(f(h),{icon:a.loading?a.loadingIcon:l.value,class:L(a.loading?"h-5 w-5 animate-spin text-amber-600":"h-6 w-6 text-amber-600")},null,8,["icon","class"])],6)],46,re),g(Y,{name:"fade-slide",mode:"out-in"},{default:J(()=>[a.helperText?(u(),d("p",ue,c(a.helperText),1)):B("",!0)]),_:1})]))}}),me=Z(ce,[["__scopeId","data-v-633bb232"]]),ve={class:"max-w-2xl mx-auto px-4 py-8"},fe={key:0,class:"flex justify-center items-center min-h-[400px]"},ge={key:1,class:"text-center py-12"},pe={class:"mt-1 text-gray-500"},be={key:2,class:"space-y-8"},he={key:0,class:"bg-white rounded-xl shadow-lg overflow-hidden"},xe={class:"relative h-48 bg-gray-100"},ye=["src","alt"],we={key:1,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-r from-amber-500 to-amber-600"},ke={class:"p-6"},_e={class:"text-2xl font-bold text-gray-900"},Re={class:"mt-3"},Ce={key:0,class:"text-sm text-gray-600 line-clamp-3"},Ie={key:1,class:"space-y-3 text-sm text-gray-600"},Se={class:"bg-amber-50 border border-amber-100 rounded-lg p-3"},Pe={class:"text-sm font-semibold text-amber-800 flex items-center gap-2"},Be={class:"space-y-2"},Ee={class:"text-sm font-semibold text-gray-900 flex items-center gap-2"},Me={class:"mt-1 text-xs text-gray-600"},Le={key:0},Te={class:"text-sm font-semibold text-gray-900 flex items-center gap-2"},$e={class:"mt-1 text-xs text-gray-600"},De={class:"inline-flex items-center gap-2"},je={class:"mt-6 space-y-3 text-sm"},Ae={class:"flex justify-between items-center"},Ne={class:"font-medium text-gray-900"},ze={class:"flex justify-between items-center"},qe={class:"font-medium text-gray-900"},He={class:"flex justify-between items-center border-t border-gray-200 pt-3"},Oe={class:"font-medium text-gray-900"},Ve={class:"space-y-4"},We=["disabled"],Ue=V({__name:"Redeem",setup(a){const S=se(),E=ae(),i=te(),$=ee(),m=r(!0),v=r(!1),x=r(""),s=r(null),b=r(!1),p=r(!1),o=k(()=>i.getters["auth/currentMembership"]),_=k(()=>{if(!s.value)return!1;const l=o.value?.points??0;return s.value.isAvailable&&l>=s.value.pointsCost&&(!s.value.quantity||s.value.quantity>0)&&(!s.value.expiresAt||new Date(s.value.expiresAt)>new Date)}),y=async()=>{try{m.value=!0,v.value=!1;const l=E.params.id,t=await O.getReward(l);s.value=t}catch(l){v.value=!0,x.value="Failed to load reward details. Please try again.",console.error("Error fetching reward:",l)}finally{m.value=!1}},R=l=>{if(!l)return"mdi:gift";const t={"Birthday Reward":"mdi:cake","VIP Experience":"mdi:star","Mystery Brew":"mdi:flask","Loyalty Bonus":"mdi:heart",Achievement:"mdi:trophy"};if(t[l.name])return t[l.name];switch(l.type){case"product":return"mdi:gift";case"service":return"mdi:sparkles";case"discount":return"mdi:ticket";case"experience":return"mdi:star";default:return"mdi:gift"}},M=async()=>{if(!(!s.value||!_.value||b.value))try{b.value=!0,await O.redeemReward(s.value._id,o.value?.id);const l=(o.value?.points??0)-s.value.pointsCost;i.commit("auth/UPDATE_MEMBERSHIP_POINTS",l);const t=E.params.code;S.push({name:"member-rewards",params:{code:t},query:{redeemed:"1",rewardId:s.value._id,rewardName:s.value.name}})}catch(l){$("Failed to redeem reward. Please try again.","error"),console.error("Error redeeming reward:",l)}finally{b.value=!1}},D=()=>{p.value=!p.value};return W(y),(l,t)=>(u(),d("div",ve,[m.value?(u(),d("div",fe,[...t[2]||(t[2]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-amber-500 border-t-transparent"},null,-1)])])):v.value?(u(),d("div",ge,[g(f(h),{icon:"mdi:alert-circle",class:"mx-auto h-12 w-12 text-red-500"}),t[4]||(t[4]=e("h3",{class:"mt-2 text-lg font-medium text-gray-900"},"Failed to load reward",-1)),e("p",pe,c(x.value),1),e("button",{onClick:t[0]||(t[0]=w=>f(S).back()),class:"mt-4 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700"},[g(f(h),{icon:"mdi:arrow-left",class:"mr-2 h-5 w-5"}),t[3]||(t[3]=I(" Go Back ",-1))])])):(u(),d("div",be,[t[13]||(t[13]=e("div",{class:"text-center"},[e("h1",{class:"text-3xl font-bold text-gray-900"},"Confirm Redemption"),e("p",{class:"mt-2 text-gray-600"},"Quickly review the essentials. Tap below if you need the full details.")],-1)),s.value?(u(),d("div",he,[e("div",xe,[s.value.base64Image?(u(),d("img",{key:0,src:s.value.base64Image,alt:s.value.name,class:"absolute inset-0 w-full h-full object-cover object-center"},null,8,ye)):(u(),d("div",we,[g(f(h),{icon:R(s.value),class:"h-16 w-16 text-white"},null,8,["icon"])]))]),e("div",ke,[e("h2",_e,c(s.value.name),1),e("div",Re,[p.value?(u(),d("div",Ie,[e("p",null,c(s.value.description),1),e("div",Se,[e("h3",Pe,[g(f(h),{icon:"mdi:information",class:"h-4 w-4"}),t[5]||(t[5]=I(" How redemption works ",-1))]),t[6]||(t[6]=e("p",{class:"mt-1 text-xs text-amber-700"}," Slide to confirm when you are ready to redeem. Staff will validate this reward in person. ",-1))]),e("div",Be,[e("div",null,[e("h3",Ee,[g(f(h),{icon:"mdi:clipboard-text",class:"h-4 w-4 text-amber-600"}),t[7]||(t[7]=I(" Redemption Instructions ",-1))]),e("p",Me,c(s.value.redemptionInstructions||"Show this reward to staff to redeem."),1)]),s.value.termsAndConditions?(u(),d("div",Le,[e("h3",Te,[g(f(h),{icon:"mdi:shield-check",class:"h-4 w-4 text-amber-600"}),t[8]||(t[8]=I(" Terms & Conditions ",-1))]),e("p",$e,c(s.value.termsAndConditions),1)])):B("",!0)])])):(u(),d("p",Ce,c(s.value.description),1)),e("button",{class:"mt-3 text-sm font-medium text-amber-600 hover:text-amber-700 focus:outline-none",onClick:D},[e("span",De,[g(f(h),{icon:p.value?"mdi:chevron-up":"mdi:chevron-down",class:"h-4 w-4"},null,8,["icon"]),I(" "+c(p.value?"Hide":"See more")+" details ",1)])])]),e("div",je,[e("div",Ae,[t[9]||(t[9]=e("span",{class:"text-gray-500"},"Your Current Points",-1)),e("span",Ne,c(o.value?.points??0),1)]),e("div",ze,[t[10]||(t[10]=e("span",{class:"text-gray-500"},"Points Required",-1)),e("span",qe,c(s.value.pointsCost),1)]),e("div",He,[t[11]||(t[11]=e("span",{class:"text-gray-500"},"Remaining Points",-1)),e("span",Oe,c((o.value?.points??0)-s.value.pointsCost),1)])])])])):B("",!0),e("div",Ve,[g(me,{disabled:!_.value,loading:b.value,title:s.value?.name,subtitle:`Redeem for ${s.value?.pointsCost??0} points`,label:"Slide to redeem","confirm-label":"Keep sliding to confirm","success-label":"Redeemed","helper-text":"Slide fully to the right to confirm redemption","success-icon":"mdi:gift-open",icon:"mdi:gesture-swipe-right",onConfirm:M},null,8,["disabled","loading","title","subtitle"]),e("button",{onClick:t[1]||(t[1]=w=>f(S).back()),disabled:b.value,class:"w-full btn btn-secondary flex items-center justify-center gap-2"},[g(f(h),{icon:"mdi:arrow-left",class:"h-5 w-5"}),t[12]||(t[12]=I(" Go Back ",-1))],8,We)])]))]))}});export{Ue as default};
