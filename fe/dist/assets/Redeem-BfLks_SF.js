import{m as B,u as A,f as u,p as h,q as E,g as M,c as n,o as i,a as t,e as c,k as l,I as m,t as r,d as y,l as N,i as _,n as q,s as S,y as k}from"./index-Bi5mqW00.js";const T={class:"max-w-2xl mx-auto px-4 py-8"},V={key:0,class:"flex justify-center items-center min-h-[400px]"},D={key:1,class:"text-center py-12"},F={class:"mt-1 text-gray-500"},G={key:2,class:"space-y-8"},$={key:0,class:"bg-white rounded-xl shadow-lg overflow-hidden"},z={class:"relative h-48 bg-gray-100"},H=["src","alt"],L={key:1,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-r from-amber-500 to-amber-600"},O={class:"p-6"},U={class:"text-2xl font-bold text-gray-900"},Y={class:"mt-2 text-gray-600"},J={class:"mt-6 space-y-3 text-sm"},K={class:"flex justify-between items-center"},Q={class:"font-medium text-gray-900"},W={class:"flex justify-between items-center"},X={class:"font-medium text-gray-900"},Z={class:"flex justify-between items-center border-t border-gray-200 pt-3"},ee={class:"font-medium text-gray-900"},te={class:"mt-6"},se={class:"mt-2 text-sm text-gray-600"},ae={key:0,class:"mt-6"},re={class:"mt-2 text-sm text-gray-500"},oe={class:"flex flex-col gap-4"},ne=["disabled"],ie=["disabled"],ue=B({__name:"Redeem",setup(le){const v=N(),x=S(),g=E(),R=A(),p=u(!0),f=u(!1),b=u(""),s=u(null),o=u(!1),d=h(()=>g.getters["auth/currentMembership"]),w=h(()=>{if(!s.value)return!1;const a=d.value?.points??0;return s.value.isAvailable&&a>=s.value.pointsCost&&(!s.value.quantity||s.value.quantity>0)&&(!s.value.expiresAt||new Date(s.value.expiresAt)>new Date)}),C=async()=>{try{p.value=!0,f.value=!1;const a=x.params.id,e=await k.getReward(a);s.value=e}catch(a){f.value=!0,b.value="Failed to load reward details. Please try again.",console.error("Error fetching reward:",a)}finally{p.value=!1}},I=a=>{if(!a)return"mdi:gift";const e={"Birthday Reward":"mdi:cake","VIP Experience":"mdi:star","Mystery Brew":"mdi:flask","Loyalty Bonus":"mdi:heart",Achievement:"mdi:trophy"};if(e[a.name])return e[a.name];switch(a.type){case"product":return"mdi:gift";case"service":return"mdi:sparkles";case"discount":return"mdi:ticket";case"experience":return"mdi:star";default:return"mdi:gift"}},P=async()=>{if(!(!s.value||!w.value||o.value))try{o.value=!0,await k.redeemReward(s.value._id,d.value?.id);const a=(d.value?.points??0)-s.value.pointsCost;g.commit("auth/UPDATE_MEMBERSHIP_POINTS",a);const e=x.params.code;v.push({name:"member-rewards",params:{code:e},query:{redeemed:"1",rewardId:s.value._id,rewardName:s.value.name}})}catch(a){R("Failed to redeem reward. Please try again.","error"),console.error("Error redeeming reward:",a)}finally{o.value=!1}};return M(C),(a,e)=>(i(),n("div",T,[p.value?(i(),n("div",V,[...e[2]||(e[2]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-amber-500 border-t-transparent"},null,-1)])])):f.value?(i(),n("div",D,[c(l(m),{icon:"mdi:alert-circle",class:"mx-auto h-12 w-12 text-red-500"}),e[4]||(e[4]=t("h3",{class:"mt-2 text-lg font-medium text-gray-900"},"Failed to load reward",-1)),t("p",F,r(b.value),1),t("button",{onClick:e[0]||(e[0]=j=>l(v).back()),class:"mt-4 inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-600 hover:bg-amber-700"},[c(l(m),{icon:"mdi:arrow-left",class:"mr-2 h-5 w-5"}),e[3]||(e[3]=y(" Go Back ",-1))])])):(i(),n("div",G,[e[11]||(e[11]=t("div",{class:"text-center"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"Confirm Redemption"),t("p",{class:"mt-2 text-gray-600"},"Please review the details before redeeming your reward")],-1)),s.value?(i(),n("div",$,[t("div",z,[s.value.base64Image?(i(),n("img",{key:0,src:s.value.base64Image,alt:s.value.name,class:"absolute inset-0 w-full h-full object-cover object-center"},null,8,H)):(i(),n("div",L,[c(l(m),{icon:I(s.value),class:"h-16 w-16 text-white"},null,8,["icon"])]))]),t("div",O,[t("h2",U,r(s.value.name),1),t("p",Y,r(s.value.description),1),t("div",J,[t("div",K,[e[5]||(e[5]=t("span",{class:"text-gray-500"},"Your Current Points",-1)),t("span",Q,r(d.value?.points??0),1)]),t("div",W,[e[6]||(e[6]=t("span",{class:"text-gray-500"},"Points Required",-1)),t("span",X,r(s.value.pointsCost),1)]),t("div",Z,[e[7]||(e[7]=t("span",{class:"text-gray-500"},"Remaining Points",-1)),t("span",ee,r((d.value?.points??0)-s.value.pointsCost),1)])]),t("div",te,[e[8]||(e[8]=t("h3",{class:"font-medium text-gray-900"},"Redemption Instructions",-1)),t("p",se,r(s.value.redemptionInstructions||"Show this reward to staff to redeem."),1)]),s.value.termsAndConditions?(i(),n("div",ae,[e[9]||(e[9]=t("h3",{class:"font-medium text-gray-900"},"Terms & Conditions",-1)),t("p",re,r(s.value.termsAndConditions),1)])):_("",!0)])])):_("",!0),t("div",oe,[t("button",{onClick:P,disabled:o.value||!w.value,class:"w-full btn btn-primary flex items-center justify-center gap-2 py-4 text-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed"},[c(l(m),{icon:o.value?"mdi:loading":"mdi:gift",class:q([{"animate-spin":o.value},"h-6 w-6"])},null,8,["icon","class"]),y(" "+r(o.value?"Redeeming...":"Confirm Redemption"),1)],8,ne),t("button",{onClick:e[1]||(e[1]=j=>l(v).back()),disabled:o.value,class:"w-full btn btn-secondary flex items-center justify-center gap-2"},[c(l(m),{icon:"mdi:arrow-left",class:"h-5 w-5"}),e[10]||(e[10]=y(" Go Back ",-1))],8,ie)])]))]))}});export{ue as default};
