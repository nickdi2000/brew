import{p as K,f as c,q as C,B as F,g as G,C as Z,c as f,o as v,a as e,e as o,i as _,t as d,D as H,n as $,k as r,I as u,T as W,w as q,_ as Y,u as ee,s as te,E as se,d as R,l as ae,x as le,z as X}from"./index-LGvmhA-u.js";const ne={class:"w-full space-y-3"},oe={class:"text-center"},ie={key:0,class:"text-base font-semibold text-gray-900"},re={key:1,class:"mt-1 text-sm text-gray-500"},de=["aria-label","aria-disabled"],ce={class:"relative flex-1 flex items-center justify-center pointer-events-none"},ue={key:"helper",class:"text-center text-xs text-gray-500"},A=.85,V=8,me=K({__name:"SlideToConfirm",props:{label:{type:String,default:"Slide to confirm"},confirmLabel:{type:String,default:"Keep sliding to confirm"},successLabel:{type:String,default:"Confirmed"},subtitle:{type:String,default:""},title:{type:String,default:""},icon:{type:String,default:"mdi:arrow-right"},successIcon:{type:String,default:"mdi:check"},loadingIcon:{type:String,default:"mdi:loading"},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},helperText:{type:String,default:""},autoReset:{type:Boolean,default:!0},trackHeight:{type:Number,default:60}},emits:["confirm"],setup(a,{expose:E,emit:N}){const i=a,B=N,b=c(0),x=c(!1),I=c(null),s=c(!1),y=c(0),g=c(0),m=c(null),S=c(null),w=c(null),k=C(()=>Math.max(y.value-g.value-V*2,0)),p=C(()=>x.value&&(i.loading||b.value===1)?k.value:Math.min(k.value,Math.max(0,b.value*k.value))),T=C(()=>{const l=V+g.value/2+p.value;return l<=0?0:Math.min(y.value,l)}),D=C(()=>x.value&&!i.loading||b.value>=A&&!i.loading?i.successIcon:i.icon),O=C(()=>i.loading?"Processing...":x.value?i.successLabel:b.value>=A?i.confirmLabel:i.label),P=()=>{!m.value||!S.value||(y.value=m.value.offsetWidth,g.value=S.value.offsetWidth)},j=l=>Math.min(1,Math.max(0,l)),z=l=>{if(!m.value)return;const M=m.value.getBoundingClientRect(),J=l-M.left-V-g.value/2,Q=j(J/Math.max(k.value,1));b.value=Q},U=()=>{if(s.value){if(s.value=!1,I.value=null,window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",h),i.disabled||i.loading){n();return}b.value>=A?(x.value=!0,b.value=1,B("confirm")):n()}},n=()=>{b.value=0,x.value=!1},t=l=>{!s.value||I.value!==l.pointerId||(l.preventDefault(),z(l.clientX))},h=l=>{I.value===l.pointerId&&(l.preventDefault(),U())},L=l=>{if(!(i.disabled||i.loading)){if(m.value)try{m.value.setPointerCapture(l.pointerId)}catch(M){console.debug("Unable to set pointer capture",M)}P(),s.value=!0,I.value=l.pointerId,z(l.clientX),window.addEventListener("pointermove",t,{passive:!1}),window.addEventListener("pointerup",h,{passive:!1})}};return F(()=>i.loading,(l,M)=>{!l&&M&&i.autoReset&&n()}),F(()=>i.disabled,l=>{l&&n()}),G(()=>{P(),w.value=new ResizeObserver(()=>{P()}),m.value&&w.value.observe(m.value),window.addEventListener("resize",P)}),Z(()=>{window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",h),window.removeEventListener("resize",P),w.value&&m.value&&w.value.unobserve(m.value),w.value=null}),E({resetSlider:n}),(l,M)=>(v(),f("div",ne,[e("div",oe,[a.title?(v(),f("h3",ie,d(a.title),1)):_("",!0),a.subtitle?(v(),f("p",re,d(a.subtitle),1)):_("",!0)]),e("div",{ref_key:"trackRef",ref:m,class:$(["relative flex items-center rounded-full bg-gray-100 shadow-inner overflow-hidden touch-pan-y",[a.disabled||a.loading?"opacity-60 cursor-not-allowed":"cursor-pointer",x.value&&!a.loading?"bg-amber-100":"bg-gray-100"]]),style:H({height:`${a.trackHeight}px`}),role:"button","aria-label":a.title||a.label,"aria-disabled":a.disabled||a.loading,onPointerdown:L},[e("div",{class:"absolute inset-y-0 left-0 bg-amber-500 transition-colors",style:H({width:`${T.value}px`})},null,4),e("div",ce,[e("span",{class:$(["text-sm font-medium transition-colors",[x.value&&!a.loading||b.value>=A?"text-amber-700":"text-gray-600",a.loading?"opacity-70":"opacity-100"]])},d(O.value),3)]),e("div",{ref_key:"handleRef",ref:S,class:$(["absolute top-1 bottom-1 left-1 w-14 rounded-full bg-white shadow-lg flex items-center justify-center transition-transform duration-150 ease-out",[x.value&&!a.loading?"ring-2 ring-amber-400":"ring-0",a.disabled||a.loading?"pointer-events-none":"pointer-events-auto"]]),style:H({transform:`translateX(${p.value}px)`})},[o(r(u),{icon:a.loading?a.loadingIcon:D.value,class:$(a.loading?"h-5 w-5 animate-spin text-amber-600":"h-6 w-6 text-amber-600")},null,8,["icon","class"])],6)],46,de),o(W,{name:"fade-slide",mode:"out-in"},{default:q(()=>[a.helperText?(v(),f("p",ue,d(a.helperText),1)):_("",!0)]),_:1})]))}}),fe=Y(me,[["__scopeId","data-v-633bb232"]]),ve={class:"relative bg-gray-50 flex flex-col",style:{"min-height":"calc(100vh - 140px)"}},be={key:0,class:"absolute inset-0 flex justify-center items-center bg-white z-50"},xe={key:1,class:"absolute inset-0 flex flex-col items-center justify-center px-6 bg-white z-50"},ge={class:"mt-2 text-gray-600 text-center"},pe={key:2,class:"flex flex-col flex-1"},he={class:"sticky top-0 z-20 bg-white/95 backdrop-blur-sm border-b border-gray-200"},ye={class:"px-4 py-3 flex items-center"},we=["disabled"],_e={class:"flex-1 overflow-y-auto pb-[220px]"},ke={class:"min-h-full pb-8"},Re={key:0,class:"relative h-64 bg-gray-100"},Ce=["src","alt"],Ie={key:1,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-amber-500 to-amber-600"},Se={key:1,class:"bg-white px-6 py-6"},Pe={class:"text-2xl font-bold text-gray-900"},Me={class:"mt-1 text-sm text-amber-600 font-medium"},Ee={key:0,class:"mt-6 space-y-4 pb-4"},$e={class:"text-sm font-semibold text-gray-900 flex items-center gap-2"},Be={class:"mt-1 text-sm text-gray-600"},Te={class:"bg-amber-50 border border-amber-100 rounded-xl p-4"},De={class:"text-sm font-semibold text-amber-800 flex items-center gap-2"},je={class:"text-sm font-semibold text-gray-900 flex items-center gap-2"},ze={class:"mt-1 text-sm text-gray-600"},Le={key:0},Ae={class:"text-sm font-semibold text-gray-900 flex items-center gap-2"},Ne={class:"mt-1 text-sm text-gray-600"},Oe={class:"border-t border-gray-200 pt-4 space-y-3 text-sm"},Ue={class:"text-sm font-semibold text-gray-900 flex items-center gap-2"},He={class:"flex justify-between items-center"},Ve={class:"font-medium text-gray-900"},We={class:"flex justify-between items-center"},qe={class:"font-medium text-gray-900"},Fe={class:"flex justify-between items-center border-t border-gray-200 pt-3"},Xe={class:"font-semibold text-gray-900"},Ke={class:"inline-flex items-center gap-2"},Ge={key:0,class:"px-6 py-8"},Ye={class:"text-center mb-6"},Je={class:"relative inline-block animate-success-bounce"},Qe={class:"mt-2 text-emerald-200 animate-slide-up-delay"},Ze={class:"bg-emerald-900/40 rounded-xl p-4 border border-emerald-600/30 animate-fade-in-delay-1"},et={class:"flex items-center justify-between"},tt={class:"flex items-center gap-2"},st={class:"text-sm font-semibold text-emerald-200"},at={class:"mt-4 bg-emerald-900/40 rounded-xl p-4 border border-emerald-600/30 animate-fade-in-delay-2"},lt={class:"flex items-center justify-between"},nt={class:"flex items-center gap-2"},ot={class:"text-sm font-semibold text-emerald-200"},it={class:"mt-3 flex items-center justify-between pt-3 border-t border-emerald-600/30"},rt={class:"flex items-center gap-2"},dt={class:"text-sm font-semibold text-emerald-200"},ct={key:0},ut={class:"px-6 pt-4 pb-3 bg-gradient-to-r from-slate-700 to-slate-800 border-b border-slate-600"},mt={class:"flex items-start gap-3"},ft={class:"text-xs text-slate-300 mt-0.5"},vt={class:"relative px-6 py-6 bg-slate-800"},bt={class:"relative z-10"},xt=K({__name:"Redeem",setup(a){const E=ae(),N=le(),i=te(),B=ee(),b=c(!0),x=c(!1),I=c(""),s=c(null),y=c(!1),g=c(!1),m=c(!1),S=c(null),w=c("");let k=null;const p=C(()=>i.getters["auth/currentMembership"]),T=C(()=>p.value?.organization?.name||""),D=C(()=>{if(!s.value)return!1;const n=p.value?.points??0;return s.value.isAvailable&&n>=s.value.pointsCost&&(!s.value.quantity||s.value.quantity>0)&&(!s.value.expiresAt||new Date(s.value.expiresAt)>new Date)}),O=async()=>{try{b.value=!0,x.value=!1;const n=N.params.id,t=await X.getReward(n);s.value=t}catch(n){x.value=!0,I.value="Failed to load reward details. Please try again.",console.error("Error fetching reward:",n)}finally{b.value=!1}},P=n=>{if(!n)return"mdi:gift";const t={"Birthday Reward":"mdi:cake","VIP Experience":"mdi:star","Mystery Brew":"mdi:flask","Loyalty Bonus":"mdi:heart",Achievement:"mdi:trophy"};if(t[n.name])return t[n.name];switch(n.type){case"product":return"mdi:gift";case"service":return"mdi:sparkles";case"discount":return"mdi:ticket";case"experience":return"mdi:star";default:return"mdi:gift"}},j=()=>{if(!S.value)return;const t=new Date().getTime()-S.value.getTime(),h=Math.floor(t/1e3),L=Math.floor(h/60);if(L>0){const l=h%60;w.value=`${L}m ${l}s ago`}else w.value=`${h}s ago`},z=async()=>{if(!(!s.value||!D.value||y.value))try{y.value=!0,await X.redeemReward(s.value._id,p.value?.id);const n=(p.value?.points??0)-s.value.pointsCost;i.commit("auth/UPDATE_MEMBERSHIP_POINTS",n),m.value=!0,S.value=new Date,j(),k=window.setInterval(j,1e3),B("Reward redeemed successfully!","success")}catch(n){B("Failed to redeem reward. Please try again.","error"),console.error("Error redeeming reward:",n)}finally{y.value=!1}},U=()=>{g.value=!g.value};return G(O),se(()=>{k!==null&&clearInterval(k)}),(n,t)=>(v(),f("div",ve,[b.value?(v(),f("div",be,[...t[3]||(t[3]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-amber-500 border-t-transparent"},null,-1)])])):x.value?(v(),f("div",xe,[o(r(u),{icon:"mdi:alert-circle",class:"h-16 w-16 text-red-500"}),t[5]||(t[5]=e("h3",{class:"mt-4 text-xl font-semibold text-gray-900"},"Failed to load reward",-1)),e("p",ge,d(I.value),1),e("button",{onClick:t[0]||(t[0]=h=>r(E).back()),class:"mt-6 px-6 py-3 rounded-full bg-amber-600 text-white font-medium shadow-lg active:scale-95 transition-transform"},[o(r(u),{icon:"mdi:arrow-left",class:"inline mr-2 h-5 w-5"}),t[4]||(t[4]=R(" Go Back ",-1))])])):(v(),f("div",pe,[e("div",he,[e("div",ye,[e("button",{onClick:t[1]||(t[1]=h=>r(E).back()),disabled:y.value,class:"p-2 -ml-2 rounded-full hover:bg-gray-100 active:bg-gray-200 transition-colors"},[o(r(u),{icon:"mdi:arrow-left",class:"h-6 w-6 text-gray-700"})],8,we),t[6]||(t[6]=e("h1",{class:"flex-1 text-center text-lg font-semibold text-gray-900 pr-10"},"Confirm Redemption",-1))])]),e("div",_e,[e("div",ke,[s.value?(v(),f("div",Re,[s.value.base64Image?(v(),f("img",{key:0,src:s.value.base64Image,alt:s.value.name,class:"absolute inset-0 w-full h-full object-cover object-center"},null,8,Ce)):(v(),f("div",Ie,[o(r(u),{icon:P(s.value),class:"h-24 w-24 text-white drop-shadow-lg"},null,8,["icon"])]))])):_("",!0),s.value?(v(),f("div",Se,[e("h2",Pe,d(s.value.name),1),e("p",Me,d(s.value.pointsCost)+" points",1),g.value?(v(),f("div",Ee,[e("div",null,[e("h3",$e,[o(r(u),{icon:"mdi:text",class:"h-4 w-4 text-amber-600"}),t[7]||(t[7]=R(" Description ",-1))]),e("p",Be,d(s.value.description),1)]),e("div",Te,[e("h3",De,[o(r(u),{icon:"mdi:information",class:"h-4 w-4"}),t[8]||(t[8]=R(" How redemption works ",-1))]),t[9]||(t[9]=e("p",{class:"mt-1 text-xs text-amber-700"}," Slide to confirm when you are ready to redeem. Staff will validate this reward in person. ",-1))]),e("div",null,[e("h3",je,[o(r(u),{icon:"mdi:clipboard-text",class:"h-4 w-4 text-amber-600"}),t[10]||(t[10]=R(" Redemption Instructions ",-1))]),e("p",ze,d(s.value.redemptionInstructions||"Show this reward to staff to redeem."),1)]),s.value.termsAndConditions?(v(),f("div",Le,[e("h3",Ae,[o(r(u),{icon:"mdi:shield-check",class:"h-4 w-4 text-amber-600"}),t[11]||(t[11]=R(" Terms & Conditions ",-1))]),e("p",Ne,d(s.value.termsAndConditions),1)])):_("",!0),e("div",Oe,[e("h3",Ue,[o(r(u),{icon:"mdi:coins",class:"h-4 w-4 text-amber-600"}),t[12]||(t[12]=R(" Points Breakdown ",-1))]),e("div",He,[t[13]||(t[13]=e("span",{class:"text-gray-500"},"Your Current Points",-1)),e("span",Ve,d(p.value?.points??0),1)]),e("div",We,[t[14]||(t[14]=e("span",{class:"text-gray-500"},"Points Required",-1)),e("span",qe,d(s.value.pointsCost),1)]),e("div",Fe,[t[15]||(t[15]=e("span",{class:"text-gray-500"},"Remaining Points",-1)),e("span",Xe,d((p.value?.points??0)-s.value.pointsCost),1)])])])):_("",!0),e("button",{class:"mt-6 text-sm font-medium text-amber-600 hover:text-amber-700 active:text-amber-800 focus:outline-none w-full py-3 border border-amber-200 rounded-xl hover:bg-amber-50 active:bg-amber-100 transition-all",onClick:U},[e("span",Ke,[o(r(u),{icon:g.value?"mdi:chevron-up":"mdi:chevron-down",class:"h-5 w-5"},null,8,["icon"]),R(" "+d(g.value?"Hide":"See more")+" details ",1)])])])):_("",!0)])]),e("div",{class:$(["fixed bottom-0 left-0 right-0 max-w-[420px] mx-auto z-30 border-t transition-all duration-700",m.value?"bg-emerald-800 border-emerald-700":"bg-slate-800 border-slate-700"])},[o(W,{"enter-active-class":"transition-all duration-700 ease-out","enter-from-class":"opacity-0 scale-95 translate-y-8","enter-to-class":"opacity-100 scale-100 translate-y-0"},{default:q(()=>[m.value?(v(),f("div",Ge,[e("div",Ye,[e("div",Je,[t[16]||(t[16]=e("div",{class:"absolute inset-0 bg-emerald-400/40 blur-2xl rounded-full animate-pulse-slow"},null,-1)),t[17]||(t[17]=e("div",{class:"absolute inset-0 bg-emerald-300/30 blur-xl rounded-full"},null,-1)),o(r(u),{icon:"mdi:check-circle",class:"relative h-20 w-20 text-emerald-300 drop-shadow-lg animate-success-rotate"})]),t[18]||(t[18]=e("h2",{class:"mt-4 text-2xl font-bold text-white animate-slide-up"},"Redeemed Successfully!",-1)),e("p",Qe,d(s.value?.name),1)]),e("div",Ze,[e("div",et,[e("div",tt,[o(r(u),{icon:"mdi:clock-outline",class:"h-5 w-5 text-emerald-300"}),t[19]||(t[19]=e("span",{class:"text-sm font-medium text-emerald-100"},"Redeemed",-1))]),e("span",st,d(w.value),1)])]),e("div",at,[e("div",lt,[e("div",nt,[o(r(u),{icon:"mdi:minus-circle",class:"h-5 w-5 text-emerald-300"}),t[20]||(t[20]=e("span",{class:"text-sm font-medium text-emerald-100"},"Points Used",-1))]),e("span",ot,d(s.value?.pointsCost),1)]),e("div",it,[e("div",rt,[o(r(u),{icon:"mdi:wallet",class:"h-5 w-5 text-emerald-300"}),t[21]||(t[21]=e("span",{class:"text-sm font-medium text-emerald-100"},"Current Balance",-1))]),e("span",dt,d(p.value?.points??0),1)])]),e("button",{onClick:t[2]||(t[2]=h=>r(E).back()),class:"mt-6 w-full py-4 bg-emerald-600 hover:bg-emerald-500 active:bg-emerald-700 text-white font-semibold rounded-xl transition-colors shadow-lg flex items-center justify-center gap-2 animate-fade-in-delay-3"},[o(r(u),{icon:"mdi:arrow-left",class:"h-5 w-5"}),t[22]||(t[22]=R(" Back to Rewards ",-1))])])):_("",!0)]),_:1}),o(W,{"enter-active-class":"transition-all duration-300","leave-active-class":"transition-all duration-300","enter-from-class":"opacity-0","leave-to-class":"opacity-0"},{default:q(()=>[m.value?_("",!0):(v(),f("div",ct,[e("div",ut,[e("div",mt,[o(r(u),{icon:"mdi:account-alert",class:"h-5 w-5 text-blue-400 flex-shrink-0 mt-0.5"}),e("div",null,[t[23]||(t[23]=e("p",{class:"text-xs font-semibold text-white"},"Only swipe when staff is watching",-1)),e("p",ft," Make sure "+d(T.value?`${T.value} staff`:"staff")+" can see your screen before redeeming ",1)])])]),e("div",vt,[t[24]||(t[24]=e("div",{class:"absolute inset-x-6 top-1/2 -translate-y-1/2 h-20 bg-blue-500/30 blur-2xl rounded-full animate-pulse-slow"},null,-1)),t[25]||(t[25]=e("div",{class:"absolute inset-x-6 top-1/2 -translate-y-1/2 h-16 bg-blue-400/20 blur-xl rounded-full"},null,-1)),e("div",bt,[o(fe,{disabled:!D.value,loading:y.value,label:"Slide to redeem","confirm-label":"Keep sliding to confirm","success-label":"Redeemed","success-icon":"mdi:gift-open",icon:"mdi:gesture-swipe-right",onConfirm:z},null,8,["disabled","loading"])])])]))]),_:1})],2)]))]))}}),pt=Y(xt,[["__scopeId","data-v-2ee8753b"]]);export{pt as default};
