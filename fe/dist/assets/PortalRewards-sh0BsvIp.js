import{m as $,u as q,f,p as v,q as A,g as S,c as n,o as i,a as e,e as l,k as a,I as c,s as E,i as R,t as d,l as F,d as g,F as V,x as D,y as L,n as _}from"./index-DBYf_VYy.js";const M={class:"min-h-screen bg-gray-50"},P={key:0,class:"flex items-center justify-center min-h-[50vh]"},T={key:1,class:"flex items-center justify-center min-h-[50vh]"},z={class:"bg-white border-l-4 border-red-500 p-4 rounded-lg max-w-sm shadow-sm"},U={class:"flex items-center"},G={key:2,class:"max-w-7xl mx-auto px-4 py-6"},H={key:0,class:"min-h-screen flex items-center justify-center p-4"},J={class:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-8 shadow-xl border border-green-200 max-w-md w-full mx-auto"},K={class:"flex flex-col items-center space-y-4"},O={class:"relative"},Q={class:"flex items-center justify-center h-20 w-20 rounded-full bg-green-100"},W={class:"absolute -right-2 -top-2 animate-bounce"},X={key:0,class:"w-full"},Y={class:"bg-white rounded-xl p-4 shadow border border-green-100"},Z={class:"text-base text-gray-800 font-medium text-center"},ee={key:1},te={key:0,class:"space-y-6"},se={class:"relative h-48 bg-gray-100 overflow-hidden"},oe=["src","alt"],ne={key:1,class:"absolute inset-0 flex items-center justify-center bg-gradient-to-r from-amber-500 to-amber-600"},ie={class:"absolute bottom-0 left-0 right-0 flex items-end justify-between p-6"},ae={class:"text-2xl font-bold text-white drop-shadow-lg"},re={class:"bg-white/90 backdrop-blur-sm rounded-full px-4 py-2"},le={class:"text-lg font-bold text-amber-600"},ce={class:"p-6"},de={class:"mb-4"},me={class:"mb-4"},ue={key:0,class:"text-sm text-gray-500"},pe={key:1},ge=["onClick"],xe={key:1,class:"text-sm text-gray-500"},he=["onClick"],be={class:"w-full"},ye=["onClick","disabled"],fe={key:0},ve={key:1},_e={key:2},ke={key:1,class:"text-center py-12 bg-white shadow rounded-xl"},Re=$({__name:"PortalRewards",setup(we){const k=A(),x=F(),m=E(),w=q(),p=f(!0),h=f(!1),b=f([]),y=v(()=>k.getters["auth/currentMembership"]);v(()=>k.getters.organization);const j=v(()=>[...b.value].sort((o,t)=>{const s=r(o),u=r(t);return s&&!u?-1:!s&&u?1:0})),N=async()=>{try{p.value=!0,h.value=!1;const o=await L.getRewards();b.value=o.rewards.map(t=>({...t,expanded:!1}))}catch{h.value=!0,w("Failed to load rewards","error")}finally{p.value=!1}},B=o=>{const t={"Birthday Reward":"mdi:cake","VIP Experience":"mdi:star","Mystery Brew":"mdi:flask","Loyalty Bonus":"mdi:heart",Achievement:"mdi:trophy"};if(t[o.name])return t[o.name];switch(o.type){case"product":return"mdi:gift";case"service":return"mdi:sparkles";case"discount":return"mdi:ticket";case"experience":return"mdi:star";default:return"mdi:gift"}},r=o=>{const t=y.value?.points??0;return o.isAvailable&&t>=o.pointsCost&&(!o.quantity||o.quantity>0)&&(!o.expiresAt||new Date(o.expiresAt)>new Date)},C=o=>{o.expanded=!o.expanded},I=o=>{if(!r(o))return;const t=m.params.code;x.push({name:"member-redeem",params:{code:t,id:o._id}})};return S(async()=>{try{await N()}catch(o){console.error("❌ Failed to load rewards:",o),w("Failed to load rewards","error")}}),(o,t)=>(i(),n("div",M,[p.value?(i(),n("div",P,[...t[2]||(t[2]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-amber-600 mx-auto"}),e("p",{class:"mt-4 text-gray-500 animate-pulse"},"Loading rewards...")],-1)])])):h.value?(i(),n("div",T,[e("div",z,[e("div",U,[l(a(c),{icon:"mdi:alert",class:"h-5 w-5 text-red-500 flex-shrink-0"}),t[3]||(t[3]=e("p",{class:"ml-3 text-sm text-gray-700"},"Unable to load rewards.",-1))])])])):(i(),n("div",G,[a(m).query.redeemed==="1"?(i(),n("div",H,[e("div",J,[e("div",K,[e("div",O,[e("div",Q,[l(a(c),{icon:"mdi:check-circle",class:"h-12 w-12 text-green-600"})]),e("div",W,[l(a(c),{icon:"mdi:party-popper",class:"h-8 w-8 text-green-500"})])]),t[5]||(t[5]=e("div",{class:"text-center"},[e("h1",{class:"text-3xl font-bold text-green-800"},"Success!"),e("p",{class:"text-lg text-green-700 font-medium mt-1"},"Reward redeemed successfully")],-1)),a(m).query.rewardName?(i(),n("div",X,[e("div",Y,[e("p",Z,d(String(a(m).query.rewardName)),1)])])):R("",!0),e("button",{onClick:t[0]||(t[0]=s=>a(x).push(`/members/${a(m).params.code}`)),class:"w-full px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-xl transition-colors shadow-md flex items-center justify-center gap-2"},[l(a(c),{icon:"mdi:arrow-left",class:"h-5 w-5"}),t[4]||(t[4]=g(" Back to Portal ",-1))])])])])):(i(),n("div",ee,[e("button",{onClick:t[1]||(t[1]=s=>a(x).push(`/members/${a(m).params.code}`)),class:"mb-6 inline-flex items-center text-gray-600 hover:text-gray-900"},[l(a(c),{icon:"mdi:arrow-left",class:"h-5 w-5 mr-1"}),t[6]||(t[6]=e("span",null,"Back",-1))]),b.value.length>0?(i(),n("div",te,[(i(!0),n(V,null,D(j.value,s=>(i(),n("div",{key:s._id,class:_(["group overflow-hidden rounded-xl shadow-lg hover:shadow-xl transition-all duration-200",r(s)?"bg-white ring-2 ring-green-400 ring-opacity-50":"bg-gray-50 opacity-75"])},[e("div",se,[s.base64Image?(i(),n("img",{key:0,src:s.base64Image,alt:s.name,class:"absolute inset-0 w-full h-full object-cover object-center"},null,8,oe)):(i(),n("div",ne,[l(a(c),{icon:B(s),class:"h-16 w-16 text-white"},null,8,["icon"])])),t[7]||(t[7]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-black/50 via-transparent to-black/50"},null,-1)),e("div",ie,[e("h3",ae,d(s.name),1),e("div",re,[e("span",le,d(s.pointsCost.toLocaleString())+" pts",1)])])]),e("div",ce,[e("div",de,[e("span",{class:_(["inline-flex items-center px-3 py-1 rounded-full text-sm font-medium",r(s)?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"])},[l(a(c),{icon:r(s)?"mdi:check-circle":"mdi:lock",class:"mr-1.5 h-4 w-4"},null,8,["icon"]),g(" "+d(r(s)?"Eligible":"Not enough points"),1)],2)]),e("div",me,[s.description.length<=70?(i(),n("p",ue,d(s.description),1)):(i(),n("div",pe,[s.expanded?(i(),n("p",xe,[g(d(s.description)+" ",1),e("span",{class:"text-amber-600 font-medium ml-1 cursor-pointer hover:text-amber-700 transition-colors",onClick:u=>C(s)}," Show less ",8,he)])):(i(),n("p",{key:0,class:"text-sm text-gray-500 cursor-pointer hover:text-gray-700 transition-colors",onClick:u=>C(s)},[g(d(s.description.substring(0,70))+"... ",1),t[8]||(t[8]=e("span",{class:"text-amber-600 font-medium ml-1"},"Read more",-1))],8,ge))]))]),e("div",be,[e("button",{onClick:u=>I(s),class:_(["w-full px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2",{"bg-black text-white hover:bg-gray-800 hover:scale-[1.02]":r(s),"bg-gray-100 text-gray-400 cursor-not-allowed":!r(s)}]),disabled:!r(s)},[l(a(c),{icon:r(s)?"mdi:gift":"mdi:lock",class:"h-5 w-5"},null,8,["icon"]),s.isAvailable?(y.value?.points??0)<s.pointsCost?(i(),n("span",ve," Need "+d(s.pointsCost-(y.value?.points??0))+" More Points ",1)):(i(),n("span",_e,"Redeem Now")):(i(),n("span",fe,"Currently Unavailable"))],10,ye)])])],2))),128))])):p.value?R("",!0):(i(),n("div",ke,[l(a(c),{icon:"mdi:ticket",class:"mx-auto h-12 w-12 text-gray-400"}),t[9]||(t[9]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No rewards available",-1)),t[10]||(t[10]=e("p",{class:"mt-1 text-sm text-gray-500"},"Check back later for new rewards.",-1))]))]))]))]))}});export{Re as default};
